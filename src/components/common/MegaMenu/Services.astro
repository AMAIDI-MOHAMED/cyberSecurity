---
import Icon from "@ui/icons/Icon.astro";
import { servicesMenu } from "@utils/megaMenu/services";
const sectionDescription = "Comprehensive GRC, compliance, and anti-fraud services for Finland and the EU";
const currentPath = Astro.url.pathname;
const lang = currentPath.startsWith('/fi') ? 'fi' : 'en';
---

<div class="relative group">
  <button
    id="mega-menu-services"
    type="button"
    class={`flex items-center px-2.5 py-1.5 text-xs font-medium rounded-md transition-colors focus:outline-none focus-visible:ring-2 focus-visible:ring-teal-500 ${
      currentPath.startsWith("/services") ? "text-teal-700 bg-teal-50" : "text-slate-700 hover:text-teal-700 hover:bg-slate-50"
    }`}
    aria-haspopup="menu"
    aria-expanded="false"
    aria-label="Services Mega Menu"
  >
    {lang === 'fi' ? 'PALVELUT' : 'SERVICES'} <Icon name="arrowDownRight" class="w-3 h-3 ml-1" />
  </button>

  <div
    class="absolute left-0 top-full min-w-[800px] bg-white shadow-lg rounded-lg border border-slate-200 opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all duration-150 z-50"
    role="menu"
    aria-orientation="vertical"
    aria-labelledby="mega-menu-services"
  >
    <div class="p-6">
      <p class="text-sm text-slate-600 mb-4">
        {sectionDescription}
      </p>
      <hr class="mb-4 border border-slate-200" />

      <div class="grid grid-cols-3 gap-6">
        {
          servicesMenu.map((section) => (
            <div class="flex flex-col">
              <p class="text-xs font-semibold text-slate-800 mb-2 uppercase tracking-wide">{section.sectionTitle}</p>

              {section.items.map((item) => {
                const href = lang === 'fi' ? `/fi${item.href}` : item.href;
                return (
                  <a
                    class="flex gap-x-3 rounded-md p-2 hover:bg-slate-50 focus:bg-slate-50 focus:outline-none transition-colors"
                    href={href}
                  >
                    <Icon name={item.icon} class="mt-0.5 w-4 h-4 shrink-0 text-slate-600" />

                    <div class="grow">
                      <p class="text-xs font-medium text-slate-800">
                        {item.title}
                      </p>
                      <p class="text-[11px] text-slate-500 mt-0.5">{item.description}</p>
                    </div>
                  </a>
                );
              })}
            </div>
          ))
        }
      </div>
    </div>
  </div>
</div>
