---
const formStrings = {
  name: "Name",
  email: "Email",
  message: "Message",
  submit: "Submit",
};
---

<form class="p-4" aria-labelledby="form-title">
  {/* Fieldset and legend for grouping form elements */}
  <fieldset class="space-y-4">
    <legend id="form-title" class="sr-only">{formStrings.submit}</legend>

    {/* Name input field */}
    <div class="relative">
      <input
        type="text"
        id="input-name"
        class="peer block w-full rounded-lg border border-transparent p-4 text-sm placeholder:text-transparent autofill:pb-2 autofill:pt-6 focus:border-teal-700/80 focus:pb-2 focus:pt-6 focus:outline-hidden focus:ring-2 focus:ring-teal-700/80 not-placeholder-shown:pb-2 not-placeholder-shown:pt-6"
        placeholder={formStrings.name}
        required
        aria-required="true"
        aria-labelledby="input-name-label"
      />
      <label
        id="input-name-label"
        for="input-name"
        class="pointer-events-none absolute start-0 top-0 h-full truncate border border-transparent p-4 text-slate-600 transition duration-100 ease-in-out peer-focus:-translate-y-1.5 peer-focus:text-xs peer-focus:text-slate-600 peer-not-placeholder-shown:-translate-y-1.5 peer-not-placeholder-shown:text-xs peer-not-placeholder-shown:text-slate-600"
      >
        {formStrings.name}
      </label>
    </div>

    {/* Email input field */}
    <div class="relative">
      <input
        type="email"
        id="input-email"
        class="peer block w-full rounded-lg border border-transparent p-4 text-sm placeholder:text-transparent autofill:pb-2 autofill:pt-6 focus:border-teal-700/80 focus:pb-2 focus:pt-6 focus:outline-hidden focus:ring-2 focus:ring-teal-700/80 not-placeholder-shown:pb-2 not-placeholder-shown:pt-6"
        placeholder={formStrings.email}
        required
        aria-required="true"
        aria-labelledby="input-email-label"
        aria-invalid="false"
      />
      <label
        id="input-email-label"
        for="input-email"
        class="pointer-events-none absolute start-0 top-0 h-full w-full truncate border border-transparent p-4 text-slate-600 transition duration-100 ease-in-out peer-focus:-translate-y-1.5 peer-focus:text-xs peer-focus:text-slate-600 peer-not-placeholder-shown:-translate-y-1.5 peer-not-placeholder-shown:text-xs peer-not-placeholder-shown:text-slate-600"
      >
        {formStrings.email}
      </label>
    </div>

    {/* Company input field */}
    <div class="relative">
      <input
        type="text"
        id="input-company"
        class="peer block w-full rounded-lg border border-transparent p-4 text-sm placeholder:text-transparent focus:border-teal-700/80 focus:outline-hidden focus:ring-2 focus:ring-teal-700/80"
        placeholder="Company"
        aria-labelledby="input-company-label"
      />
      <label
        id="input-company-label"
        for="input-company"
        class="pointer-events-none absolute start-0 top-0 h-full truncate border border-transparent p-4 text-slate-600 transition duration-100 ease-in-out peer-focus:-translate-y-1.5 peer-focus:text-xs peer-focus:text-slate-600 peer-not-placeholder-shown:-translate-y-1.5 peer-not-placeholder-shown:text-xs peer-not-placeholder-shown:text-slate-600"
      >
        Company
      </label>
    </div>

    {/* Phone input field */}
    <div class="relative">
      <input
        type="tel"
        id="input-phone"
        class="peer block w-full rounded-lg border border-transparent p-4 text-sm placeholder:text-transparent focus:border-teal-700/80 focus:outline-hidden focus:ring-2 focus:ring-teal-700/80"
        placeholder="Phone"
        aria-labelledby="input-phone-label"
      />
      <label
        id="input-phone-label"
        for="input-phone"
        class="pointer-events-none absolute start-0 top-0 h-full truncate border border-transparent p-4 text-slate-600 transition duration-100 ease-in-out peer-focus:-translate-y-1.5 peer-focus:text-xs peer-focus:text-slate-600 peer-not-placeholder-shown:-translate-y-1.5 peer-not-placeholder-shown:text-xs peer-not-placeholder-shown:text-slate-600"
      >
        Phone
      </label>
    </div>

    {/* Service select field */}
    <div class="relative">
      <select
        id="input-service"
        class="peer block w-full rounded-lg border border-transparent p-4 text-sm focus:border-teal-700/80 focus:outline-hidden focus:ring-2 focus:ring-teal-700/80"
        aria-labelledby="input-service-label"
      >
        <option value="">Select a service</option>
        <option value="CISO-as-a-Service">CISO-as-a-Service</option>
        <option value="ISO 27001">ISO 27001</option>
        <option value="GDPR">GDPR</option>
        <option value="NIS2">NIS2</option>
        <option value="DORA">DORA</option>
        <option value="SOC 2">SOC 2</option>
        <option value="Other">Other</option>
      </select>
      <label
        id="input-service-label"
        for="input-service"
        class="pointer-events-none absolute start-0 top-0 h-full truncate border border-transparent p-4 text-slate-600 transition duration-100 ease-in-out peer-focus:-translate-y-1.5 peer-focus:text-xs peer-focus:text-slate-600 peer-not-placeholder-shown:-translate-y-1.5 peer-not-placeholder-shown:text-xs peer-not-placeholder-shown:text-slate-600"
      >
        Service
      </label>
    </div>

    {/* Message textarea field */}
    <div class="relative">
      <textarea
        id="input-message"
        class="peer block w-full rounded-lg border border-transparent p-4 text-sm placeholder:text-transparent autofill:pb-2 autofill:pt-6 focus:border-teal-700/80 focus:pb-2 focus:pt-6 focus:outline-hidden focus:ring-2 focus:ring-teal-700/80 not-placeholder-shown:pb-2 not-placeholder-shown:pt-6"
        placeholder={formStrings.message}
        required
        aria-required="true"
        aria-labelledby="input-message-label"></textarea>
      <label
        id="input-message-label"
        for="input-message"
        class="pointer-events-none absolute start-0 top-0 h-full truncate border border-transparent p-4 text-slate-600 transition duration-100 ease-in-out peer-focus:-translate-y-1.5 peer-focus:text-xs peer-focus:text-slate-600 peer-not-placeholder-shown:-translate-y-1.5 peer-not-placeholder-shown:text-xs peer-not-placeholder-shown:text-slate-600"
      >
        {formStrings.message}
      </label>
    </div>
  </fieldset>

      {/* Submit button */}
  <div class="mt-8">
    <button
      type="submit"
      class="inline-flex items-center text-nowrap rounded-lg bg-teal-100 px-6 py-2 font-medium text-slate-700 transition-colors duration-300 hover:bg-teal-700/80 hover:text-white focus:bg-teal-700/80 focus:outline-hidden"
      aria-label={formStrings.submit}
    >
      {formStrings.submit}
    </button>
  </div>
</form>

<script>
document.querySelector('form')?.addEventListener('submit', async (e) => {
  e.preventDefault();
  const nameInput = document.getElementById('input-name') as HTMLInputElement | null;
  const emailInput = document.getElementById('input-email') as HTMLInputElement | null;
  const companyInput = document.getElementById('input-company') as HTMLInputElement | null;
  const phoneInput = document.getElementById('input-phone') as HTMLInputElement | null;
  const serviceInput = document.getElementById('input-service') as HTMLSelectElement | null;
  const messageInput = document.getElementById('input-message') as HTMLTextAreaElement | null;

  if (!nameInput || !emailInput || !messageInput || !companyInput || !phoneInput || !serviceInput) {
    alert('Form fields missing. Please reload the page.');
    return;
  }

  const name = nameInput.value;
  const email = emailInput.value;
  const company = companyInput.value;
  const phone = phoneInput.value;
  const service = serviceInput.value;
  const message = messageInput.value;

  const payload = { name, email, company, phone, service, message };

  try {
    const res = await fetch('/api/contact', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify(payload)
    });
    const result = await res.json();
    if (result.success) {
      alert('Message sent successfully!');
    } else {
      alert('There was an error sending your message. Please try again.');
    }
  } catch (err) {
    alert('Network error. Please try again later.');
  }
});
</script>

